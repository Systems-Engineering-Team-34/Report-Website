<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Implementation</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/icon/IFRCfavicon.ico" rel="icon">
  <link href="assets/img/icon/IFRCfavicon.ico" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Scaffold
  * Updated: Jan 29 2024 with Bootstrap v5.3.2
  * Template URL: https://bootstrapmade.com/scaffold-bootstrap-metro-style-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center">

      <div class="logo me-auto">
        <h1><a href="index.html">RedCrossConnect</a></h1>
      </div>

      <nav id="navbar" class="navbar order-last order-lg-0">
        <nav id="navbar" class="navbar order-last order-lg-0">
          <ul>
            <li class="list"><a href="index.html" class="active"><span>Home</span></a></li>
            <li class="dropdown"><a href="requirements.html"><span>Requirements</span></a>
              <ul>
                <li><a href="requirements.html#requirements-partner-intro">Client Introduction</a></li>
                <li><a href="requirements.html#requirements-project-background">Project Background</a></li>
                <li><a href="requirements.html#requirements-project-goals">Project Goals</a></li>
                <li><a href="requirements.html#requirements-gathering">Requirements Gathering</a></li>
                <li><a href="requirements.html#requirements-personas">Personas</a></li>
                <li><a href="requirements.html#requirements-use-cases">Use Case</a></li>
                <li><a href="requirements.html#requirements-moscow-list">MoSCoW List</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="research.html"><span>Research</span></a>
              <ul>
                <li><a href="research.html#research-project">Project Research</a></li>
                <li><a href="research.html#research-technology">Technology Research</a></li>
                <li><a href="research.html#research-technical-decisions">Technical Decisions</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="UIdesign.html"><span>UI Design</span></a>
              <ul>
                <li><a href="UIdesign.html#UIDesign-requirements">Design Requirements</a></li>
                <li><a href="UIdesign.html#UIDesign-design-principles">Design Principles</a></li>
                <li><a href="UIdesign.html#UIDesign-Sketches">Sketches</a></li>
                <li><a href="UIdesign.html#UIDesign-Prototype">Prototypes</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="design.html"><span>System Design</span></a>
              <ul>
                <li><a href="design.html#design-system-architecture">System Architecture</a></li>
                <li><a href="design.html#design-survey-bot-flow">Survey Bot Flow</a></li>
                <li><a href="design.html#design-site-map">Site Map</a></li>
                <li><a href="design.html#design-data-storage">Data Storage</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="implementation.html"><span>Impl.</span></a>
              <ul>
                <li><a href="implementation.html#implementation-survey-tool">Survey Bot Impl.</a></li>
                <li><a href="implementation.html#implementation-front-end">Frontend Impl.</a></li>
                <li><a href="implementation.html#implementation-back-end">Backend Impl.</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="testing.html"><span>Testing</span></a>
              <ul>
                <li><a href="testing.html#testing-strategy">Testing Strategy</a></li>
                <li><a href="testing.html#testing-automated">Automated Testing</a></li>
                <li><a href="testing.html#testing-uat">User Acceptance Testing</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="evaluation.html"><span>Evaluation</span></a>
              <ul>
                <li><a href="evaluation.html#evaluation-achievement-list">Achievement List</a></li>
                <li><a href="evaluation.html#evaluation-bug-list">Bug List</a></li>
                <li><a href="evaluation.html#evaluation-individual-contribution">Individual Contribution</a></li>
                <li><a href="evaluation.html#evaluation-critical-evaluation">Critical Evaluation</a></li>
                <li><a href="evaluation.html#evaluation-future-work">Future Work</a></li>
              </ul>
            </li>
            <li class="list"><a href="appendices.html"><span>Appendices</span></a></li>
          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>
    </div>
  </header>

  <!-- ======= Hero Section ======= -->
  <section id="hero">

    <div class="custom-container">
      <div class="row">
        <div class="d-flex flex-column justify-content-center" data-aos="fade-up">
          <h1>Implementation</h1>
        </div>
      </div>
    </div>

  </section><!-- End Hero -->

  <main id="main">

    <div class="custom-container">
      <div id="implementation-survey-tool">
        <h2 class="text-decoration-underline">Survey Bot Implementation</h2>
        <h4 class="text-decoration-underline text-container">Key Libraries and Frameworks Used:</h4>
        <ol type="1" class="text-container">
          <li>Django: A high-level Python Web framework that encourages rapid development and clean, pragmatic design. Used here to create web views and interact with the database via models.</li>
          <li>Twilio API for WhatsApp: Used to send and receive messages between the bot and users on WhatsApp. The <code>Client</code> from <code>twilio.rest</code> enables sending messages, managing responses, and handling user sessions.</li>
          <li>PyCountry: Utilized for country validation and manipulation. This helps in processing user inputs for country-related questions.</li>
          <li>FuzzyWuzzy: A library that uses Levenshtein Distance to calculate the differences between sequences. This is particularly useful for matching user input to cities, providing a form of error tolerance.</li>
          <li>allcities : This library assists in managing the city data together used with the FuzzyWuzzy libraries to match the user input with a known list of cities accurately.</li>
        </ol>
        <h4 class="text-decoration-underline text-container">Flow and Key Features</h4>
        <p class="text-container">
          1. User Interaction Handling: The <code>bot</code> view function is the core of the survey bot, designed to handle <code>POST</code> 
          requests from Twilio's webhook configured for the WhatsApp number. It processes messages received from users, determines the 
          current stage of the user interaction, and dispatches control to the appropriate handler functions based on the user's 
          current state and input.
        </p>
        <img src="assets/img/implementation/surveytool/survey-bot-user-interaction-handling.png" alt="Survey Bot Flow" width="50%" class="pb-2">
        <p class="text-container">
          2. State Management: The <code>UserState</code> model keeps track of each user's current interaction stage, which guides the 
          bot on which question to ask next or what action to perform. This state-driven logic enables the bot to handle complex 
          interactions, including survey participation, personal detail updates, and navigation through different options. The code 
          snippet demonstrates how the <code>UserState</code> model manages the flow of interactions by checking the user's current 
          stage and then invoking different functions to handle the user’s progression through the survey bot’s features.
        </p>
        <img src="assets/img/implementation/surveytool/survey-bot-state-management.png" alt="Survey Bot State Management" width="55%" class="pb-2">
        <p class="text-container">
          3. Message Sending and Receiving: Utilizes Twilio's <code>Client</code> to send messages to users and receive responses. 
          This includes sending questions, options for users to select, and handling custom messages like welcoming new users or 
          thanking them after completing surveys. The example from the code snippet shows <code>send_gender_message</code> 
          demonstrates sending a gender query message with <code>1</code> is the text message and <code>2</code> to <code>4</code> 
          representing buttons options for user responses.
        </p>
        <img src="assets/img/implementation/surveytool/survey-bot-message-send-and-receive.png" alt="Survey Bot Message Sending and Receiving" width="55%" class="pb-2">
        <p class="text-container">
          4. Dynamic Survey Handling: The bot dynamically handles surveys and questions from the database. Surveys and their 
          corresponding questions are stored in models and fetched as needed, allowing for a flexible survey system that can be 
          expanded or modified without changing the bot's codebase. In the provided code snippet, the function 
          <code>handle_survey_response</code> deals with user answers within a survey. It first attempts to save a user's response 
          with <code>save_survey_response</code> and, based on whether the save was successful, either retrieves the next question 
          using <code>get_next_survey_question</code> or concludes the survey if there are no more questions. This approach ensures 
          that the survey bot responds adaptively, presenting subsequent questions in a sequence or closing the interaction gracefully 
          once the user has completed the survey.
        </p>
        <img src="assets/img/implementation/surveytool/survey-bot-handle-survey-response.png" alt="Survey Bot Dynamic Survey Handling" width="55%" class="pb-2">
        <p class="text-container">
          5. Personalization and Localization: By leveraging user information and inputs (e.g., country and city from user responses), 
          the bot can offer a more personalized experience. This is further enhanced with the use of <code>PyCountry</code> for country 
          validation and <code>FuzzyWuzzy</code> and <code>allcities</code> both used for flexible city matching, adding a layer of 
          user-friendly interaction by tolerating minor typos or variations in user inputs.
        </p>
        <img src="assets/img/implementation/surveytool/survey-bot-city-country-checker.png" alt="Survey Bot Personalization and Localization" width="55%" class="pb-2">
        <h4 class="text-decoration-underline text-container">Models Implementation</h4>
        <p class="text-container">The models define the structure of the database used by the survey bot for storing surveys, questions, user states, and other necessary information:</p>
        <p class="text-container">
          1. Survey-related Models: <code>Survey</code>, <code>SurveyQuestion</code>, and <code>QuestionOption</code> models store 
          information about each survey, the questions within those surveys, and the options for each question, respectively. This 
          structure supports creating surveys with multiple-choice questions, where each question can have multiple predefined answers.
        </p>
        <img src="assets/img/implementation/surveytool/survey-question-model.png" alt="Survey Bot Survey-related Models" width="65%" class="pb-2">
        <p class="text-container">
          2. User Information Models: <code>Person</code>, <code>UserState</code>, and <code>Community</code> models track 
          user-specific information. <code>Person</code> stores basic user details, <code>UserState</code> keeps track of where the 
          user is in the survey or bot interaction, and <code>Community</code> used to store the information of the city in the 
          country to be displayed on the dashboard.
        </p>
        <img src="assets/img/implementation/surveytool/person-model.png" alt="Survey Bot User Information Models" width="63%" class="pb-2">
        <p class="text-container">
          3. Response Model: The <code>Response</code> model captures users' answers to survey questions, linking each response to the 
          specific user and survey question.
        </p>
        <img src="assets/img/implementation/surveytool/response-model.png" alt="Survey Bot Response Model" width="63%" class="pb-2">
        <h4 class="text-decoration-underline text-container">Database Connection:</h4>
        <p class="text-container">
          Django's ORM (Object-Relational Mapping) is utilized for database interactions. This abstracts the database layer, allowing 
          developers to interact with the database using Python code instead of SQL. The <code>models.py</code> file contains the schema 
          definitions for each table in the database, and Django automatically generates the necessary SQL commands for all CRUD 
          (Create, Read, Update, Delete) operations.
        </p>
      </div>
      <br>
      <div id="implementation-front-end">
        <h2 class="text-decoration-underline">Front-end Implementation</h2>
        <h4 class="text-decoration-underline text-container">Pages and Routing</h4>
        <p class="text-container">
          With the dashboard, there is a need to create multiple pages and therefore needs routing. This includes pages for the home 
          page, select country page, country info page and the region / community response page. To create the different routing options, 
          we used the <code>react-router-dom</code> package. This package allows us to create different routes for different pages. Moreover, with this, 
          we were able to allow for parameters to be passed through the URL. This was important as we needed to pass variables such as the 
          country code or community id to retrieve the correct data.
        </p>
        <img src="assets/img/implementation/frontend/react-code-app-route.png" alt="Pages" width="55%" class="pb-2">
        <p class="text-container">
          The code above shows the different routes that we have created. The <code>BrowserRouter</code> component is used to wrap the 
          different routes. The <code>Route</code> component is then used to create the different routes. The <code>element</code> attribute is used to specify the 
          component that should be rendered when the route is matched. The <code>:countryCode</code> and <code>:communityID</code> are used to specify a parameter that can be 
          passed through the URL. This parameter can then be accessed in the component using the <code>useParams()</code> hook.
        </p>
        <p class="text-container">
          In terms of creating the content of each page and components, we used regular react conventions and hooks such as <code>useState</code> and 
          <code>useEffect</code> etc. Furthermore, for styling the components, we primarily used <code>TailwindCSS</code> as it was easy to utilise.
        </p>
        <h4 class="text-decoration-underline text-container">Interfaces / Types</h4>
        <p class="text-container">
          Using Typescript for react means that there needs to be ways to deal with the different types and interfaces. In our project, 
          we created many different <code>interfaces</code> to store the different types for different object such as communityInfo (pictured below), 
          countryInfo etc. This was important as it allowed us to easily pass and store the correct data to the correct components, reducing the 
          chances of errors due to typing.
        </p>
        <img src="assets/img/implementation/frontend/react-code-interfaces.png" alt="Interfaces" width="25%" class="pb-2">
        <h4 class="text-decoration-underline text-container">Map</h4>
        <p class="text-container">
          For the map component, we utilised the <code>react-simple-map</code> package. This package was very useful as it had many usable 
          attributes such as <code>ZoomableGroup</code> and <code>Marker</code>. Furthermore, we also had to use a <code>geojson</code> file that 
          contained the coordinates for the different counties, allowing us to display the world map as well as mark the different zones. Moreover,
          to allow the map to be interactive and zoomable, we had to use the <code>ZoomableGroup</code> component as well as <code>useStates</code> to store the 
          current zoom level and position of the map, allowing us to create functions to handle the user zooming in and out as well as panning 
          the map.
        </p>
        <img src="assets/img/implementation/frontend/react-code-map-1.png" alt="Map" width="55%" class="pb-2">
        <p class="text-container">
          Other than displaying the map, we also had to find a way to display and mark all the countries with availble responses. With 
          <code>react-simple-maps</code>, we were able to use the <code>Marker</code> component to mark the different countries using
          coordinates, data which is already stored in our database. We also had to ensure that the markers were clickable and would 
          redirect the user to the correct country page. This was done by using the <code>Link</code> component, allowing for the page to route 
          to the correct page along with the correct parameter.
        </p>
        <img src="assets/img/implementation/frontend/react-code-map-2.png" alt="Map" width="50%" class="pb-2">
        <h4 class="text-decoration-underline text-container">Charts</h4>
        <p class="text-container">
          One of the main features of the dashboard is the ability to display the data in a visual manner. To do this, we used the <code>react-apexcharts</code> 
          package to create the different charts such as a pie chart and bar chart in a user-friendly way. The package allowed us to 
          customise the chart styles such as changing the colours and labels.
        </p>
        <img src="assets/img/implementation/frontend/react-code-pie-chart.png" alt="Chart" width="60%" class="pb-2">
        <h4 class="text-decoration-underline text-container">Social Media and Share Feature</h4>
        <p class="text-container">
          To create the functionality to share the response results to social media, we primarily wrote functions that redirects the user 
          to the social media platform page which automatically fills in the text and link. This was done by using the <code>window.open()</code> and 
          setting the url to the current url of the dashboard page (<code>const url = encodeURIComponent(window.location.href);</code>). Below is 
          the code for all the social media share functions: 
        </p>
        <img src="assets/img/implementation/frontend/react-code-share-social.png" alt="Social Media" width="90%" class="pb-2">
        <p class="text-container">
          Furthermore, to allow the user to also be able to download the chart as an image, we used the <code>html2canvas</code> package to allow 
          us to render the chart as an image. This is done through the <code>openModalWithImage</code> function. 
          The <code>downloadImage</code> function then creates a temporary link element in the document, setting its <code>href</code> 
          attribute to the data URL of the image that was previously captured and stored in <code>imageDataUrl</code>. This URL 
          represents the image of the chart intended for download. The function then sets the <code>download</code> attribute of the link 
          with a custom file name. After appending this link to the document body, the function programmatically clicks the link to initiate the 
          download, and then removes the link from the document, completing the image download process without navigating away from the 
          current page.
        </p>
        <img src="assets/img/implementation/frontend/react-code-download-image.png" alt="Download Image" width="80%" class="pb-2">
      </div>
      <br>
      <div id="implementation-back-end">
        <h2 class="text-decoration-underline">Back-end Implementation</h2>
        <h4 class="text-decoration-underline text-container">Database</h4>
        <p class="text-container">
          For our project, we selected MySQL, a relational database model, because it's well-suited for modeling real-world 
          connections. For example, a person belonging to a community, which is part of a country, can be easily represented in this 
          setup. 
        </p>
        <p class="text-container">
          We normalize the database by adhering to key normalization principles. For example, instead of storing all options 
          associated with a question in one field, we created separate tables for options and used a linking table (<code>QuestionOption</code>) to 
          establish relationships. This approach ensures atomicity of data and minimizes redundancy, supporting efficient data 
          management and maintenance.
        </p>
        <p class="text-container">
          Additionally, we utilized appropriate data types and constraints to enforce data consistency and integrity across the 
          database. Foreign key constraints, for example, were employed to establish and maintain relationships between tables, 
          ensuring referential integrity.
        </p>
        <h4 class="text-decoration-underline text-container">API</h4>
        <p class="text-container">
          In our project, the server-side API plays a critical role in mediating the interaction between the client-side application 
          and the backend systems. These APIs are designed to handle a range of requests from clients, perform the required operations 
          and then return the necessary data or results back to the client. This architecture ensures a smooth and efficient data 
          flow, enabling a responsive user experience.
        </p>
        <h5 class="text-container text-decoration-underline">Key endpoints and their operations:</h5>
        <p class="text-container">
          <code>/community/&lt;int:communityid&gt;/</code>: Fetches data about the community itself things like number of respondents 
          in the community, the country the community is located in etc… Also fetches data about the responses made by the respondents 
          of that community.
        </p>
        <p class="text-container">
          <code>/communities/</code>: Retrieves every registered community, as well as information about that community again this 
          would be things like the number of respondents, the country the community is located in etc…
        </p>
        <p class="text-container">
          <code>/countries/</code>: Retrieves all the countries from which there are respondents, as well as information about that 
          country like the number of registered communities in that country. 
        </p>
        <p class="text-container">
          <code>/surveys/</code>: Retrieves overall information like the total number of completed surveys, number of countries from 
          which there are respondents, age distribution of the respondents.
        </p>
        <p class="text-container">
          <code>country/&lt;str:countrycode&gt;/</code>: Fetches data about the country itself things like the number of communities located in that country etc… Also fetches data about the responses made by the respondents of those communities located in the specific country.
        </p>
        <h4 class="text-decoration-underline text-container">Hosting</h4>
        <p class="text-container">
          For hosting our project, we chose Azure Web App Service due to its reliability, ease of use, and seamless integration with 
          other Azure services. This platform stood out for its ability to easily scale up or down based on our application's demand, 
          ensuring cost-efficiency while maintaining performance. Additionally, Azure Web App offers built-in security and compliance 
          features, which are crucial for safeguarding our data and user information.
        </p>
        <p class="text-container">
          During development, we used a virtual environment to manage our application's dependencies. This approach greatly simplified 
          the deployment process, as it ensured our development environment closely mirrored the production environment, minimizing 
          deployment issues and external dependencies.
        </p>
        <p class="text-container">
          Moreover, our hosting setup is directly linked to GitHub, enabling continuous integration and deployment (CI/CD). This means 
          that any updates or changes pushed to our GitHub repository are automatically deployed to Azure Web App, streamlining the 
          development cycle and ensuring our application is always up-to-date without manual intervention. This integration not only 
          enhances our development workflow but also supports rapid deployment of new features and bug fixes, keeping our application 
          robust and responsive to user needs.
        </p>
      </div>
      <br>
    </div>
    
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="footer-top">
      <div class="container">
        <div class="row">

          <div class="col-lg-3 col-md-6">
            <div class="footer-info">
              <h3>RedCrossConnect</h3>
              <p>
                COMP0016 Team 34
              </p>
              <div class="social-links mt-3">
                <a href="#" class="twitter"><i class="bx bxl-github"></i></a>
                <a href="#" class="facebook"><i class="bx bxl-youtube"></i></a>
                <a href="https://pittawaskijoran29.wordpress.com" class="wordpress"><i class="bx bxl-wordpress"></i></a>
              </div>
            </div>
          </div>

          <div class="col-lg-2 col-md-6 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="index.html">Home</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="requirements.html">Requirements</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="research.html">Research</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="UIdesign.html">UI Design</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="design.html"> System Design</a></li>
            </ul>
          </div>
          <div class="col-lg-3 col-md-6 footer-links">
            <h4></h4>
            <br>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="implementation.html">Implementation</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="testing.html">Testing</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="evaluation.html">Evaluation</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="appendices.html">Appendices</a></li>
            </ul>
          </div>

          <div class="col-lg-4 col-md-6 footer-newsletter">
            <h4>Project Partners</h4>
            <a href="https://www.ucl.ac.uk/">
              <img src="assets/img/icon/UCLLogo.png" alt="UCLLogo" width="50%">
            </a>
            <a href="https://www.ifrc.org/">
              <img src="assets/img/icon/IFRCLogo.png" alt="RedCrossLogo" width="40%">
            </a>
          </div>

        </div>
      </div>
    </div>

    <div class="container">
      <div class="copyright">
        &copy; Copyright . All Rights Reserved
      </div>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>